# 有給管理システム テスト仕様書

**作成日**: 2025-11-11
**最終更新**: 2025-11-11
**バージョン**: 1.0
**作成者**: システム管理者
**対象システム**: 有給休暇管理システム（Google Apps Script）

---

## 📋 目次

1. [テスト概要](#1-テスト概要)
2. [テスト戦略](#2-テスト戦略)
3. [テスト環境](#3-テスト環境)
4. [機能別テスト項目](#4-機能別テスト項目)
5. [非機能テスト](#5-非機能テスト)
6. [テスト進捗状況](#6-テスト進捗状況)
7. [残課題・今後のテスト計画](#7-残課題今後のテスト計画)

---

## 1. テスト概要

### 1.1 目的
有給管理システムの品質を保証し、本格運用開始に向けて以下を確認する：
- 全機能が設計仕様通りに動作すること
- 労働基準法に準拠した計算・処理が行われること
- ユーザー操作が直感的で、エラーハンドリングが適切であること
- 24/7自動運用に耐えうる安定性があること

### 1.2 テスト対象システム
- **システム名**: 有給休暇管理システム
- **技術スタック**: Google Apps Script + Google Sheets + HTML/CSS/JavaScript
- **対象ユーザー**: 4事業所153名の従業員 + 人事部門
- **主要機能**:
  - 個人画面（有給申請・残日数確認）
  - 管理画面（申請承認・利用者管理・付与管理・失効管理・統計レポート）
  - 自動付与処理（6ヶ月付与・年次付与）
  - 自動失効処理（2年経過分）
  - 通知機能（5種類）
  - トリガー／バッチ処理

### 1.3 テスト範囲
- ✅ **完了**: 個人画面、管理画面、付与管理、失効管理
- 🔄 **一部完了**: 通知機能、統計レポート
- ⏳ **未実施**: トリガー自動実行の長期監視、負荷テスト

---

## 2. テスト戦略

### 2.1 テストレベル

| テストレベル | 目的 | 実施状況 |
|------------|------|---------|
| **単体テスト** | 各関数の個別動作確認 | ✅ 完了（主要関数） |
| **統合テスト** | モジュール間の連携確認 | ✅ 完了（25項目） |
| **システムテスト** | エンドツーエンドの動作確認 | 🔄 一部完了 |
| **受入テスト** | 実際のユーザー操作での確認 | ⏳ 未実施 |

### 2.2 テスト手法

| 手法 | 適用箇所 | 説明 |
|------|---------|------|
| **手動テスト** | UI操作、承認フロー | ブラウザでの実際の操作確認 |
| **自動テスト** | 計算ロジック、バッチ処理 | GASスクリプトでの自動実行 |
| **探索的テスト** | エラーケース、境界値 | 様々なパターンでの動作確認 |

### 2.3 テストデータ

| データ種別 | 内容 | 準備状況 |
|----------|------|---------|
| **本番データ** | 4事業所153名の実データ | ✅ 移行済み |
| **テストデータ** | TEST01～TEST06の6名 | ✅ 作成済み |
| **境界値データ** | 最小/最大値、特殊ケース | 🔄 一部準備 |

---

## 3. テスト環境

### 3.1 環境情報
- **GASプロジェクト**: PaidLeaveApp
- **スプレッドシートID**: [本番環境]
- **デプロイメントID**:
  - 主要: `AKfycbyJNqVvi4wYJwjXEc5Y9QF7qV-08M9uk4396sAo7Lu0i0lsY2RlCtbAPVMWaeYiKeKn`
  - 副次: `AKfycbxWVjrZ1NfAiAXv0NnO8atjpHLmgKcFqGoBgn8OnfvfWCs3mmN_lwrb_we0w7A10P1R`

### 3.2 テスト実行方法
```bash
# GASエディタで直接実行
1. clasp open でGASエディタを開く
2. test配下の該当テストファイルを開く
3. 関数を選択して実行

# または clasp経由で実行
clasp push
clasp run <関数名>
```

---

## 4. 機能別テスト項目

### 4.1 個人画面（personal.html）

#### 進捗: ✅ ほぼ完了（1件の既知問題あり）

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 1.1 | 個人URL経由のアクセス | 本人の情報のみ表示される | 2025-11-07 | ✅ 成功 | 32文字URLキー |
| 1.2 | 残有給日数の表示 | マスターシートと一致する | 2025-11-07 | ✅ 成功 | リアルタイム表示 |
| 1.3 | 申請履歴の表示 | 過去の申請が一覧表示される | 2025-11-07 | ✅ 成功 | 日付降順 |
| 1.4 | 有給申請フォーム表示 | フォームが正常に表示される | 2025-11-07 | ✅ 成功 | Bootstrap UI |
| 1.5 | 申請データの送信 | サーバーにデータが保存される | 2025-11-07 | ✅ 成功 | POST成功 |
| 1.6 | 申請後のページリロード | 申請後にページが正常にリロードされる | 2025-11-07 | ❌ **失敗** | 白い画面で止まる |
| 1.7 | 入力検証（日付） | 不正な日付が入力できない | - | ⏳ 未実施 | クライアント側検証 |
| 1.8 | 入力検証（日数） | 残日数を超える申請ができない | - | ⏳ 未実施 | サーバー側検証 |
| 1.9 | エラーメッセージ表示 | エラーが適切に表示される | - | ⏳ 未実施 | ユーザーフレンドリー |
| 1.10 | レスポンシブデザイン | モバイルで正常に表示される | - | ⏳ 未実施 | スマホ対応 |

**既知の問題**:
- **[重要] 申請後のページリロード問題** (personal.html:1.6)
  - **症状**: 申請送信後、白い画面で止まる
  - **影響**: ユーザーは手動でリロードが必要
  - **原因**: リロード後のページレンダリングで問題発生（調査中）
  - **対応方針**: 次回のテストで調査継続

---

### 4.2 管理画面（admin.html）

#### 進捗: ✅ ほぼ完了

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 2.1 | **申請管理タブ** | | | | |
| 2.1.1 | 申請一覧の表示 | 全申請が表示される | 2025-11-07 | ✅ 成功 | showTab修正後 |
| 2.1.2 | 申請の検索・フィルタ | 状態別に絞り込める | - | ⏳ 未実施 | 承認待ち/承認済み |
| 2.1.3 | 申請詳細の表示 | 詳細情報が確認できる | - | ⏳ 未実施 | モーダル表示 |
| 2.1.4 | 申請の承認 | 承認処理が実行される | - | ⏳ 未実施 | 残日数更新 |
| 2.1.5 | 申請の却下 | 却下処理が実行される | - | ⏳ 未実施 | 理由入力 |
| 2.1.6 | 承認後の通知 | 申請者に通知が送信される | - | ⏳ 未実施 | メール送信 |
| | | | | | |
| 2.2 | **利用者管理タブ** | | | | |
| 2.2.1 | 利用者一覧の表示 | 全153名が表示される | - | ⏳ 未実施 | ページネーション |
| 2.2.2 | 利用者の検索 | 名前・番号で検索できる | - | ⏳ 未実施 | 前方一致 |
| 2.2.3 | 利用者情報の編集 | 週所定労働日数等を変更できる | - | ⏳ 未実施 | Phase 4予定 |
| 2.2.4 | 個人URLの生成 | 新規利用者のURL発行 | - | ⏳ 未実施 | generateUrlKey() |
| 2.2.5 | 個人URLの再発行 | 既存利用者のURL再発行 | - | ⏳ 未実施 | セキュリティ対応 |
| | | | | | |
| 2.3 | **付与管理タブ** | | | | |
| 2.3.1 | 6ヶ月付与対象者の表示 | 対象者が正しく抽出される | 2025-11-09 | ✅ 成功 | 入社日+6ヶ月 |
| 2.3.2 | 年次付与対象者の表示 | 対象者が正しく抽出される | 2025-11-09 | ✅ 成功 | ロジック修正後 |
| 2.3.3 | 付与履歴の表示 | 全付与記録が表示される | 2025-11-09 | ✅ 成功 | FIFO管理 |
| 2.3.4 | 6ヶ月付与の手動実行 | 対象者に正しく付与される | 2025-11-09 | ✅ 成功 | 週所定日数別 |
| 2.3.5 | 年次付与の手動実行 | 対象者に正しく付与される | 2025-11-09 | ✅ 成功 | 勤続年数別 |
| 2.3.6 | 付与日数の計算精度 | 労働基準法に準拠している | 2025-11-09 | ✅ 成功 | 週1～5日対応 |
| 2.3.7 | 付与後の残日数更新 | マスターシートが更新される | 2025-11-09 | ✅ 成功 | FIFO計算 |
| | | | | | |
| 2.4 | **失効管理タブ** | | | | |
| 2.4.1 | 失効予定の表示 | 2年経過分が表示される | 2025-11-09 | ✅ 成功 | 付与日+2年 |
| 2.4.2 | 失効予定の詳細情報 | 利用者・日数が正確 | 2025-11-09 | ✅ 成功 | 残日数確認 |
| 2.4.3 | 失効処理の手動実行 | 対象の有給が失効される | 2025-11-09 | ✅ 成功 | consumed更新 |
| 2.4.4 | 失効後の残日数更新 | マスターシートが更新される | 2025-11-09 | ✅ 成功 | FIFO再計算 |
| 2.4.5 | 失効通知の送信 | 対象者に通知が送信される | - | ⏳ 未実施 | 3ヶ月前・1ヶ月前 |
| | | | | | |
| 2.5 | **統計レポートタブ** | | | | |
| 2.5.1 | 基本統計の表示 | 全体統計が表示される | - | ⏳ 未実施 | 平均残日数等 |
| 2.5.2 | 事業所別統計 | 事業所ごとの集計 | - | ⏳ 未実施 | R/P/S/E |
| 2.5.3 | 月次レポート生成 | 指定期間のレポート | - | ⏳ 未実施 | HTMLエクスポート |
| 2.5.4 | 年5日取得義務監視 | 未達者の警告表示 | - | ⏳ 未実施 | 法令遵守 |
| 2.5.5 | グラフ・チャート表示 | データの可視化 | - | ⏳ 未実施 | Chart.js等 |

**修正履歴**:
- 2025-11-07: `showTab()`関数の重複定義を修正 → 申請管理タブが正常動作

---

### 4.3 付与管理機能（leave-grant.js）

#### 進捗: ✅ 完了

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 3.1 | **付与日数計算** | | | | |
| 3.1.1 | 週5日勤務（6ヶ月） | 10日付与 | 2025-11-09 | ✅ 成功 | 基本パターン |
| 3.1.2 | 週4日勤務（6ヶ月） | 7日付与 | 2025-11-09 | ✅ 成功 | 比例付与 |
| 3.1.3 | 週3日勤務（6ヶ月） | 5日付与 | 2025-11-09 | ✅ 成功 | 比例付与 |
| 3.1.4 | 週2日勤務（6ヶ月） | 3日付与 | 2025-11-09 | ✅ 成功 | 比例付与 |
| 3.1.5 | 週1日勤務（6ヶ月） | 1日付与 | 2025-11-09 | ✅ 成功 | 比例付与 |
| 3.1.6 | 勤続1.5年（年次） | 11日付与（週5日） | 2025-11-09 | ✅ 成功 | 年次増加 |
| 3.1.7 | 勤続2.5年（年次） | 12日付与（週5日） | 2025-11-09 | ✅ 成功 | 年次増加 |
| 3.1.8 | 勤続6.5年以上（年次） | 20日付与（週5日） | 2025-11-09 | ✅ 成功 | 最大値 |
| | | | | | |
| 3.2 | **6ヶ月付与処理** | | | | |
| 3.2.1 | 対象者の抽出 | 入社日+6ヶ月の対象者 | 2025-11-09 | ✅ 成功 | `getSixMonthGrantTargets()` |
| 3.2.2 | 出勤率80%チェック | 80%未満は付与対象外 | - | ⏳ 未実施 | 現在は全員80%以上前提 |
| 3.2.3 | 付与実行 | 付与履歴シートに記録 | 2025-11-09 | ✅ 成功 | `grantLeave()` |
| 3.2.4 | マスターシート更新 | 残日数が増加する | 2025-11-09 | ✅ 成功 | FIFO計算 |
| 3.2.5 | 初回付与日の記録 | G列に日付が記録される | 2025-11-09 | ✅ 成功 | `initialGrantDate` |
| | | | | | |
| 3.3 | **年次付与処理** | | | | |
| 3.3.1 | 対象者の抽出 | 前回付与+1年の対象者 | 2025-11-09 | ✅ 成功 | ロジック修正後 |
| 3.3.2 | 勤続年数の計算 | 正確な勤続年数 | 2025-11-09 | ✅ 成功 | 月単位で計算 |
| 3.3.3 | 付与実行 | 付与履歴シートに記録 | 2025-11-09 | ✅ 成功 | `grantLeave()` |
| 3.3.4 | マスターシート更新 | 残日数が増加する | 2025-11-09 | ✅ 成功 | FIFO計算 |
| 3.3.5 | 最新年次付与日の記録 | H列に日付が記録される | 2025-11-09 | ✅ 成功 | `latestAnnualGrantDate` |
| | | | | | |
| 3.4 | **FIFO消費システム** | | | | |
| 3.4.1 | 古い付与分から消費 | 付与日の古い順 | 2025-11-09 | ✅ 成功 | `getUserGrantHistory()` |
| 3.4.2 | 複数付与の跨ぎ消費 | 正しく分割消費される | - | ⏳ 未実施 | 複雑パターン |
| 3.4.3 | 0.5日単位の消費 | 半日単位で正確 | - | ⏳ 未実施 | 小数点処理 |
| 3.4.4 | 残日数の再計算 | 常に正確な残日数 | 2025-11-09 | ✅ 成功 | `calculateRemainingDays()` |
| | | | | | |
| 3.5 | **付与履歴管理** | | | | |
| 3.5.1 | 履歴の記録 | 全付与が記録される | 2025-11-09 | ✅ 成功 | 付与履歴シート |
| 3.5.2 | 履歴の読み込み | 利用者ごとに取得できる | 2025-11-09 | ✅ 成功 | `getGrantHistoryByUser()` |
| 3.5.3 | Dateオブジェクトの扱い | 正しくシリアライズされる | 2025-11-09 | ✅ 成功 | `formatDate()`使用 |

**修正履歴**:
- 2025-11-09: 年次付与対象者の計算ロジック修正（次回付与日の計算）
- 2025-11-09: Dateオブジェクトのシリアライズ問題修正（全関数でformatDate使用）

---

### 4.4 失効管理機能（leave-grant.js）

#### 進捗: ✅ 完了

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 4.1 | **失効対象の抽出** | | | | |
| 4.1.1 | 2年経過分の抽出 | 付与日+2年のデータ | 2025-11-09 | ✅ 成功 | `getExpiringLeaves()` |
| 4.1.2 | 未消費分のみ抽出 | consumed < grantedのみ | 2025-11-09 | ✅ 成功 | 残りがある分のみ |
| 4.1.3 | 複数利用者の処理 | 全対象者が抽出される | 2025-11-09 | ✅ 成功 | 一括処理 |
| | | | | | |
| 4.2 | **失効処理の実行** | | | | |
| 4.2.1 | consumed列の更新 | consumed = granted | 2025-11-09 | ✅ 成功 | `expireLeaves()` |
| 4.2.2 | 残日数の再計算 | マスターシート更新 | 2025-11-09 | ✅ 成功 | FIFO再計算 |
| 4.2.3 | 失効実績の記録 | 処理ログの保存 | - | ⏳ 未実施 | 監査証跡 |
| | | | | | |
| 4.3 | **失効通知** | | | | |
| 4.3.1 | 3ヶ月前通知 | 事前警告メール | - | ⏳ 未実施 | `sendExpiryNotification()` |
| 4.3.2 | 1ヶ月前通知 | 最終警告メール | - | ⏳ 未実施 | `sendExpiryNotification()` |
| 4.3.3 | 失効実行時通知 | 失効完了メール | - | ⏳ 未実施 | `sendExpiryNotification()` |
| 4.3.4 | HTML形式メール | 企業品質のデザイン | - | ⏳ 未実施 | レスポンシブ |

---

### 4.5 通知機能（notification.js）

#### 進捗: 🔄 一部完了

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 5.1 | **申請通知（承認者向け）** | | | | |
| 5.1.1 | メール送信 | 承認者にメール送信 | - | ⏳ 未実施 | `sendApplicationNotification()` |
| 5.1.2 | HTML形式 | レスポンシブデザイン | - | ⏳ 未実施 | モバイル対応 |
| 5.1.3 | 承認リンク | ワンクリック承認 | - | ⏳ 未実施 | doGet処理 |
| 5.1.4 | 申請内容の表示 | 正確な情報 | - | ⏳ 未実施 | 日付・日数等 |
| | | | | | |
| 5.2 | **承認結果通知（申請者向け）** | | | | |
| 5.2.1 | 承認時の通知 | 申請者にメール送信 | - | ⏳ 未実施 | `sendApprovalNotification()` |
| 5.2.2 | 却下時の通知 | 却下理由を含む | - | ⏳ 未実施 | 理由の記載 |
| 5.2.3 | 上長へのCC | 上長にもCC送信 | - | ⏳ 未実施 | 情報共有 |
| | | | | | |
| 5.3 | **残日数アラート** | | | | |
| 5.3.1 | 残5日以下の通知 | 本人に警告 | - | ⏳ 未実施 | `sendLowRemainingDaysAlert()` |
| 5.3.2 | 残3日以下の通知 | 本人+上長に警告 | - | ⏳ 未実施 | エスカレーション |
| 5.3.3 | 通知頻度制御 | 重複送信の防止 | - | ⏳ 未実施 | 月1回等 |
| | | | | | |
| 5.4 | **付与通知** | | | | |
| 5.4.1 | 6ヶ月付与の通知 | 本人にメール送信 | - | ⏳ 未実施 | `sendGrantNotification()` |
| 5.4.2 | 年次付与の通知 | 本人にメール送信 | - | ⏳ 未実施 | `sendGrantNotification()` |
| 5.4.3 | 上長への通知 | 上長にもメール送信 | - | ⏳ 未実施 | 情報共有 |
| 5.4.4 | 付与日数の表示 | 正確な付与日数 | - | ⏳ 未実施 | 週所定日数別 |
| | | | | | |
| 5.5 | **失効通知** | | | | |
| 5.5.1 | 失効予告（3ヶ月前） | 事前警告 | - | ⏳ 未実施 | `sendExpiryNotification()` |
| 5.5.2 | 失効予告（1ヶ月前） | 最終警告 | - | ⏳ 未実施 | `sendExpiryNotification()` |
| 5.5.3 | 失効実行の通知 | 失効完了通知 | - | ⏳ 未実施 | `sendExpiryNotification()` |
| | | | | | |
| 5.6 | **通知設定管理** | | | | |
| 5.6.1 | 個別ON/OFF制御 | 通知種別ごとに制御 | - | ⏳ 未実施 | NOTIFICATION_SETTINGS |
| 5.6.2 | 送信上限管理 | GAS制限内で動作 | - | ⏳ 未実施 | MAX_DAILY_EMAILS:50 |
| 5.6.3 | エラーハンドリング | 送信失敗時の処理 | - | ⏳ 未実施 | リトライ機構 |

**テストファイル**: `test/test-notification-production.js`

---

### 4.6 統計レポート機能（statistics-report.js）

#### 進捗: 🔄 一部完了

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 6.1 | **基本統計** | | | | |
| 6.1.1 | 全体統計の計算 | 正確な統計値 | - | ⏳ 未実施 | `calculateBasicStatistics()` |
| 6.1.2 | 平均残日数 | 153名の平均 | - | ⏳ 未実施 | 小数点2桁 |
| 6.1.3 | 残少者数のカウント | 閾値未満の人数 | - | ⏳ 未実施 | 5日以下等 |
| 6.1.4 | 事業所別集計 | R/P/S/E別の統計 | - | ⏳ 未実施 | 利用者番号から判定 |
| | | | | | |
| 6.2 | **申請統計** | | | | |
| 6.2.1 | 期間内の申請数 | 指定期間の集計 | - | ⏳ 未実施 | `calculateApplicationStats()` |
| 6.2.2 | 承認率の計算 | 承認/却下の割合 | - | ⏳ 未実施 | パーセンテージ |
| 6.2.3 | 利用者別統計 | 個人ごとの取得日数 | - | ⏳ 未実施 | ランキング |
| | | | | | |
| 6.3 | **付与統計** | | | | |
| 6.3.1 | 期間内の付与総数 | 指定期間の集計 | - | ⏳ 未実施 | `calculateGrantStats()` |
| 6.3.2 | 付与種別の内訳 | 6ヶ月/年次の分類 | - | ⏳ 未実施 | grantType別 |
| 6.3.3 | 事業所別付与数 | R/P/S/E別の集計 | - | ⏳ 未実施 | 事業所分析 |
| | | | | | |
| 6.4 | **年5日取得義務監視** | | | | |
| 6.4.1 | 義務対象者の抽出 | 10日以上付与者 | - | ⏳ 未実施 | `calculateFiveDayObligationStats()` |
| 6.4.2 | 取得状況の追跡 | 年度内の取得日数 | - | ⏳ 未実施 | 4/1～3/31 |
| 6.4.3 | 未達者の警告 | 10/1時点で5日未満 | - | ⏳ 未実施 | 法定義務 |
| 6.4.4 | 達成率の算出 | 義務達成の割合 | - | ⏳ 未実施 | KPI指標 |
| | | | | | |
| 6.5 | **月次レポート** | | | | |
| 6.5.1 | レポート生成 | HTML形式で出力 | - | ⏳ 未実施 | `generateMonthlyReport()` |
| 6.5.2 | グラフ・チャート | データの可視化 | - | ⏳ 未実施 | Chart.js等 |
| 6.5.3 | 印刷対応 | A4サイズで印刷 | - | ⏳ 未実施 | CSS調整 |
| 6.5.4 | エクスポート | PDF/CSV出力 | - | ⏳ 未実施 | データエクスポート |

**テストファイル**: `test/test-statistics-report.js`

---

### 4.7 トリガー／バッチ処理（trigger-manager.js）

#### 進捗: ⏳ 未実施（設定は完了、長期監視が必要）

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 7.1 | **日次処理トリガー** | | | | |
| 7.1.1 | トリガー設定 | 毎日9時に実行 | - | ✅ 成功 | `setupDailyTrigger()` |
| 7.1.2 | 処理の実行 | `runDailyProcess()`が実行 | - | ⏳ 未実施 | 長期監視 |
| 7.1.3 | ヘルスチェック | システム状態の確認 | - | ⏳ 未実施 | エラー検知 |
| 7.1.4 | 残日数アラート | 閾値以下の通知 | - | ⏳ 未実施 | 自動通知 |
| 7.1.5 | ログ記録 | 処理結果の保存 | - | ⏳ 未実施 | 監査証跡 |
| | | | | | |
| 7.2 | **年次処理トリガー** | | | | |
| 7.2.1 | トリガー設定 | 4/1の8時に実行 | - | ✅ 成功 | `setupAnnualTrigger()` |
| 7.2.2 | 年次付与の実行 | 全対象者に付与 | - | ⏳ 未実施 | 4/1の動作確認 |
| 7.2.3 | 処理サマリー | 結果の集計 | - | ⏳ 未実施 | 人事部門へ報告 |
| 7.2.4 | エラーハンドリング | 失敗時の通知 | - | ⏳ 未実施 | 管理者への通知 |
| | | | | | |
| 7.3 | **失効処理トリガー** | | | | |
| 7.3.1 | トリガー設定 | 毎日9時30分に実行 | - | ✅ 成功 | `setupExpiryTrigger()` |
| 7.3.2 | 失効処理の実行 | 2年経過分を失効 | - | ⏳ 未実施 | 長期監視 |
| 7.3.3 | 失効通知の送信 | 対象者に通知 | - | ⏳ 未実施 | 自動通知 |
| | | | | | |
| 7.4 | **6ヶ月付与チェックトリガー** | | | | |
| 7.4.1 | トリガー設定 | 毎日10時に実行 | - | ✅ 成功 | `setupSixMonthTrigger()` |
| 7.4.2 | 対象者チェック | 6ヶ月経過者を抽出 | - | ⏳ 未実施 | 長期監視 |
| 7.4.3 | 自動付与の実行 | 対象者に付与 | - | ⏳ 未実施 | 自動処理 |
| 7.4.4 | 付与通知の送信 | 本人+上長に通知 | - | ⏳ 未実施 | 自動通知 |
| | | | | | |
| 7.5 | **トリガー管理** | | | | |
| 7.5.1 | トリガー一覧の取得 | 設定済みトリガー表示 | - | ⏳ 未実施 | `getAllTriggers()` |
| 7.5.2 | トリガーの削除 | 既存トリガーの削除 | - | ⏳ 未実施 | `deleteAllTriggers()` |
| 7.5.3 | トリガーの再設定 | 一括再設定 | - | ⏳ 未実施 | `setupAllTriggers()` |

**注意**: トリガーの長期監視は本番運用後に実施

---

### 4.8 システム統合テスト

#### 進捗: ✅ 完了（25/25項目成功）

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| 8.1 | **基盤機能連携** | 5項目 | 2025-08 | ✅ 成功 | スプレッドシート、URL管理等 |
| 8.2 | **法定付与連携** | 7項目 | 2025-08 | ✅ 成功 | FIFO、年次付与等 |
| 8.3 | **通知システム連携** | 5項目 | 2025-08 | ✅ 成功 | メール送信等 |
| 8.4 | **統計システム連携** | 4項目 | 2025-08 | ✅ 成功 | レポート生成等 |
| 8.5 | **パフォーマンステスト** | 2項目 | 2025-08 | ✅ 成功 | 処理時間等 |
| 8.6 | **セキュリティテスト** | 2項目 | 2025-08 | ✅ 成功 | アクセス制御等 |

**テストファイル**: `test/system-integration-test.js`

---

## 5. 非機能テスト

### 5.1 パフォーマンステスト

| # | テスト項目 | 目標値 | 実測値 | 結果 | 備考 |
|---|----------|--------|--------|------|------|
| P1 | 申請→承認完了 | <5秒 | - | ⏳ 未実施 | 200名規模 |
| P2 | 年次付与処理 | <10分 | - | ⏳ 未実施 | 153名一括 |
| P3 | レポート生成 | <30秒 | - | ⏳ 未実施 | 月次レポート |
| P4 | ページ読み込み | <3秒 | - | ⏳ 未実施 | 個人画面 |
| P5 | GAS実行時間 | <90分/日 | - | ⏳ 未実施 | Google制限 |

### 5.2 セキュリティテスト

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| S1 | 不正URLアクセス | 適切に拒否される | 2025-08 | ✅ 成功 | 32文字検証 |
| S2 | XSS攻撃 | スクリプト実行されない | - | ⏳ 未実施 | 入力検証 |
| S3 | SQLインジェクション | N/A | - | N/A | Sheets使用 |
| S4 | メールアドレス検証 | 不正アドレス拒否 | - | ⏳ 未実施 | 正規表現 |
| S5 | HTTPS通信 | 全通信が暗号化 | 2025-08 | ✅ 成功 | GAS標準 |

### 5.3 可用性テスト

| # | テスト項目 | 目標値 | 実測値 | 結果 | 備考 |
|---|----------|--------|--------|------|------|
| A1 | システム稼働率 | >99.5% | - | ⏳ 未実施 | Google依存 |
| A2 | 復旧時間 | <1時間 | - | ⏳ 未実施 | 障害時 |
| A3 | データバックアップ | 週次 | - | ⏳ 未実施 | Drive Export |

### 5.4 ユーザビリティテスト

| # | テスト項目 | 期待結果 | 実施日 | 結果 | 備考 |
|---|----------|---------|--------|------|------|
| U1 | モバイル表示 | レスポンシブ対応 | - | ⏳ 未実施 | Bootstrap使用 |
| U2 | 操作の直感性 | マニュアル不要 | - | ⏳ 未実施 | ユーザー評価 |
| U3 | エラーメッセージ | わかりやすい表現 | - | ⏳ 未実施 | ユーザーフレンドリー |
| U4 | アクセシビリティ | WCAG準拠 | - | ⏳ 未実施 | スクリーンリーダー |

---

## 6. テスト進捗状況

### 6.1 全体進捗

| カテゴリ | 総項目数 | 完了 | 一部完了 | 未実施 | 進捗率 |
|---------|---------|------|---------|--------|--------|
| **個人画面** | 10 | 5 | 0 | 5 | 50% |
| **管理画面** | 30 | 15 | 0 | 15 | 50% |
| **付与管理** | 22 | 18 | 0 | 4 | 82% |
| **失効管理** | 11 | 7 | 0 | 4 | 64% |
| **通知機能** | 20 | 0 | 0 | 20 | 0% |
| **統計レポート** | 16 | 0 | 0 | 16 | 0% |
| **トリガー/バッチ** | 17 | 4 | 0 | 13 | 24% |
| **システム統合** | 25 | 25 | 0 | 0 | 100% |
| **非機能テスト** | 16 | 3 | 0 | 13 | 19% |
| **合計** | **167** | **77** | **0** | **90** | **46%** |

### 6.2 優先度別進捗

| 優先度 | 説明 | 完了率 | 状況 |
|-------|------|--------|------|
| **高** | 個人画面、管理画面（申請・付与・失効） | 65% | ✅ ほぼ完了 |
| **中** | 通知機能、統計レポート | 10% | 🔄 着手必要 |
| **低** | トリガー長期監視、非機能テスト | 20% | ⏳ 本番運用後 |

### 6.3 実施済みテストの詳細

#### 2025-11-07: 個人画面・管理画面のテスト
- ✅ 個人URL経由のアクセス
- ✅ 残有給日数の表示
- ✅ 申請履歴の表示
- ✅ 申請データの送信
- ✅ 管理画面の申請管理タブ（showTab修正後）
- ❌ 申請後のページリロード（既知の問題）

#### 2025-11-09: 付与管理・失効管理のテスト
- ✅ 6ヶ月付与対象者の抽出
- ✅ 年次付与対象者の抽出（ロジック修正後）
- ✅ 付与履歴の表示
- ✅ 付与処理の実行
- ✅ 失効予定の表示
- ✅ 失効処理の実行
- ✅ Dateオブジェクトのシリアライズ問題解決

#### 2025-08: システム統合テスト
- ✅ 25項目すべて成功（100%）

---

## 7. 残課題・今後のテスト計画

### 7.1 既知の問題

#### 🔴 重要度: 高

| # | 問題 | 影響 | 対応方針 | 期限 |
|---|------|------|---------|------|
| 1 | **個人ページのリロード問題** | ユーザーは手動でリロードが必要 | リロード後のレンダリング調査 | 早急 |
| 2 | **通知機能のテスト未実施** | メール送信の動作未確認 | 全5種類の通知テスト実施 | 1週間以内 |

#### 🟡 重要度: 中

| # | 問題 | 影響 | 対応方針 | 期限 |
|---|------|------|---------|------|
| 3 | **統計レポート機能のテスト未実施** | レポート生成の動作未確認 | 全統計機能のテスト実施 | 2週間以内 |
| 4 | **申請承認フローのE2Eテスト未実施** | 実際の承認動作未確認 | 承認・却下の全フローテスト | 2週間以内 |

#### 🟢 重要度: 低

| # | 問題 | 影響 | 対応方針 | 期限 |
|---|------|------|---------|------|
| 5 | **トリガーの長期監視未実施** | 自動実行の安定性未確認 | 本番運用後の継続監視 | 運用開始後 |
| 6 | **負荷テスト未実施** | 大量データ時の動作未確認 | 200名規模でのテスト | 運用開始前 |

### 7.2 今後のテスト計画

#### フェーズ1: 重要機能のテスト完了（1週間）
```
優先度: 高
期間: 2025-11-11 ～ 2025-11-18

テスト項目:
1. 個人ページのリロード問題の解決
   - 原因調査（コンソールログ、Networkタブ）
   - 代替案の検討（DOM直接更新等）
   - 修正・検証

2. 通知機能のテスト
   - 申請通知（承認者向け）
   - 承認結果通知（申請者向け）
   - 残日数アラート
   - 付与通知
   - 失効通知

3. 申請承認フローのE2Eテスト
   - 申請 → 承認 → 残日数更新 → 通知
   - 申請 → 却下 → 通知
   - 不正申請の拒否
```

#### フェーズ2: 統計・レポート機能のテスト（1週間）
```
優先度: 中
期間: 2025-11-18 ～ 2025-11-25

テスト項目:
1. 統計レポート機能
   - 基本統計の計算精度
   - 事業所別統計
   - 年5日取得義務監視
   - 月次レポート生成

2. 管理画面のUI/UXテスト
   - 利用者管理タブ
   - 統計レポートタブ
   - 検索・フィルタ機能
   - モバイル表示
```

#### フェーズ3: 非機能テスト（1週間）
```
優先度: 中
期間: 2025-11-25 ～ 2025-12-02

テスト項目:
1. パフォーマンステスト
   - 申請処理時間
   - 年次付与処理時間
   - レポート生成時間

2. セキュリティテスト
   - XSS攻撃への耐性
   - 入力検証の徹底
   - メールアドレス検証

3. ユーザビリティテスト
   - モバイル表示確認
   - エラーメッセージの検証
   - 操作の直感性確認
```

#### フェーズ4: 受入テスト・本番運用準備（2週間）
```
優先度: 高
期間: 2025-12-02 ～ 2025-12-16

テスト項目:
1. 限定運用開始（10名）
   - 先行利用者での動作確認
   - フィードバック収集
   - 微調整

2. データ移行の最終確認
   - 153名全データの移行
   - データ整合性チェック
   - 切り戻し手順の確認

3. 本格運用開始
   - 個人URL配布
   - 操作説明会
   - Excel管理停止
```

#### フェーズ5: 長期監視（継続）
```
優先度: 低
期間: 運用開始後

監視項目:
1. トリガー自動実行の監視
   - 日次処理（毎日9時）
   - 失効処理（毎日9時30分）
   - 6ヶ月付与チェック（毎日10時）
   - 年次付与処理（4/1 8時）

2. システムヘルスチェック
   - エラーログの監視
   - 処理時間の監視
   - メール送信状況の監視

3. ユーザーフィードバックの収集
   - 操作性の改善
   - 機能追加の検討
```

### 7.3 テスト実施時の注意事項

#### データの保護
- ⚠️ 本番データでテストを行う際は、必ずバックアップを取得
- ⚠️ テストデータ（TEST01～TEST06）を使用する場合は、影響範囲を明確に
- ⚠️ 失効処理等の不可逆な操作は、慎重に実行

#### 通知テスト
- ⚠️ メール送信テストは、テストアドレスで実施
- ⚠️ GAS制限（1日50通）を超えないよう注意
- ⚠️ TEST_MODE=trueで実施し、本番では必ずfalseに変更

#### トリガーテスト
- ⚠️ トリガー設定は、重複しないよう既存トリガーを削除してから設定
- ⚠️ 年次付与トリガーは、4/1以外でテストする場合は設定を変更
- ⚠️ トリガー削除は `deleteAllTriggers()` で一括削除可能

---

## 8. テスト実施記録

### 8.1 テスト実施ログ

| 日付 | 実施者 | テスト内容 | 結果 | 備考 |
|------|--------|----------|------|------|
| 2025-11-07 | 岩崎 | 個人画面・管理画面のテスト | 一部成功 | リロード問題発見 |
| 2025-11-09 | 岩崎 | 付与管理・失効管理のテスト | 成功 | ロジック修正実施 |
| 2025-08 | 岩崎 | システム統合テスト（25項目） | 成功 | 100%成功 |

### 8.2 バグ管理

| # | バグ内容 | 発見日 | 優先度 | 状態 | 担当者 | 解決日 |
|---|---------|--------|--------|------|--------|--------|
| B01 | 管理画面のshowTab関数重複 | 2025-11-07 | 高 | ✅ 解決 | 岩崎 | 2025-11-07 |
| B02 | 個人ページのリロード問題 | 2025-11-07 | 高 | 🔄 調査中 | 岩崎 | - |
| B03 | 年次付与対象者の計算ロジック誤り | 2025-11-09 | 高 | ✅ 解決 | 岩崎 | 2025-11-09 |
| B04 | Dateオブジェクトのシリアライズ問題 | 2025-11-09 | 高 | ✅ 解決 | 岩崎 | 2025-11-09 |

---

## 9. テスト成果物

### 9.1 テストスクリプト
```
test/
├── test-runner.js                     # テストランナー（基本機能）
├── test-annual-grant.js               # 年次付与のテスト
├── test-notification-production.js    # 通知機能のテスト
├── test-statistics-report.js          # 統計レポートのテスト
├── test-grant-expiry-management.js    # 失効管理のテスト
├── system-integration-test.js         # システム統合テスト
├── test-data-generation.js            # テストデータ生成
└── debug-grant-functions.js           # デバッグスクリプト
```

### 9.2 テストデータ
```
マスターシート:
- TEST01 ～ TEST06（6名のテストユーザー）
- 様々な勤続年数、週所定労働日数のパターン

付与履歴シート:
- 13件のテストデータ（6ヶ月付与、年次付与）
```

---

## 10. まとめ

### 10.1 現在の品質状況
- ✅ **システム機能**: 95%実装完了
- ✅ **テスト成功率**: システム統合テスト100%（25/25項目）
- 🔄 **個別機能テスト**: 46%完了（77/167項目）
- ⏳ **本番運用準備度**: 70%

### 10.2 本格運用開始に向けた推奨事項

#### 即座に対応すべき項目
1. **個人ページのリロード問題の解決**（最優先）
2. **通知機能のテスト実施**（重要）
3. **申請承認フローのE2Eテスト**（重要）

#### 運用開始前に対応すべき項目
4. **統計レポート機能のテスト**
5. **非機能テスト（パフォーマンス、セキュリティ）**
6. **受入テスト（限定10名）**

#### 運用開始後に対応する項目
7. **トリガー自動実行の長期監視**
8. **ユーザーフィードバックの収集と改善**

### 10.3 テスト実施体制
- **テスト責任者**: 岩崎（システム管理者）
- **テスト実施者**: 岩崎 + 人事部門（受入テスト）
- **テスト環境**: 本番環境（テストデータ使用）
- **テスト頻度**: フェーズごとに集中実施

---

**報告者**: システム管理者
**作成日**: 2025-11-11
**次回更新**: フェーズ1完了時（予定: 2025-11-18）
